.PHONY: help build up down logs clean reset test dev prod status backup restore

help:
	@echo "B3 Trading Platform - Comandos DisponÃ­veis"
	@echo "==========================================="
	@echo "make build    - ConstrÃ³i todas as imagens Docker"
	@echo "make up       - Inicia todos os serviÃ§os"
	@echo "make down     - Para todos os serviÃ§os"
	@echo "make logs     - Mostra logs de todos os serviÃ§os"
	@echo "make clean    - Remove containers e volumes"
	@echo "make reset    - Reset completo do ambiente"
	@echo "make test     - Executa testes"
	@echo "make dev      - Inicia em modo desenvolvimento"
	@echo "make prod     - Inicia em modo produÃ§Ã£o"
	@echo "make status   - Mostra status dos serviÃ§os"
	@echo "make backup   - Backup do banco de dados"
	@echo "make restore  - Restaura backup do banco"

build:
	docker-compose build

up:
	docker-compose up -d
	@echo "âœ… B3 Trading Platform estÃ¡ rodando!"
	@echo "ðŸ“Š Dashboard: http://localhost:3000"
	@echo "ðŸš€ API: http://localhost:8000"
	@echo "ðŸ“ API Docs: http://localhost:8000/docs"
	@echo "ðŸ“ˆ Grafana: http://localhost:3001"

down:
	docker-compose down

logs:
	docker-compose logs -f

clean:
	docker-compose down -v
	docker system prune -f

reset: clean
	rm -rf logs/*
	docker-compose build --no-cache
	docker-compose up -d

test:
	docker-compose exec api pytest

dev:
	docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d

prod:
	docker-compose -f docker-compose.yml up -d

status:
	@echo "ðŸ” Status dos ServiÃ§os:"
	@docker-compose ps

backup:
	@echo "ðŸ’¾ Fazendo backup do banco de dados..."
	@docker-compose exec postgres pg_dump -U ${DB_USER} ${DB_NAME} > backup_$(shell date +%Y%m%d_%H%M%S).sql

restore:
	@echo "ðŸ“¥ Restaurando banco de dados..."
	@docker-compose exec -T postgres psql -U ${DB_USER} ${DB_NAME} < $(BACKUP_FILE)

